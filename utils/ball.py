import os
import numpy as np
from tqdm import tqdm

ball=np.array([
    [-0.034252,-24.964610,-0.005605],
    [6.565846,-23.464610,-5.505605],
    [8.565846,-23.464610,-0.005605],
    [-0.034252,-24.964610,-0.005605],
    [1.465748,-23.464610,-8.405507],
    [6.565846,-23.464610,-5.505605],
    [-0.034252,-24.964610,-0.005605],
    [-4.234203,-23.464610,-7.405507],
    [1.465748,-23.464610,-8.405507],
    [-0.034252,-24.964610,-0.005605],
    [-8.034252,-23.464610,-2.905507],
    [-4.234203,-23.464610,-7.405507],
    [-0.034252,-24.964610,-0.005605],
    [-8.034252,-23.464610,2.894542],
    [-8.034252,-23.464610,-2.905507],
    [-0.034252,-24.964610,-0.005605],
    [-4.234203,-23.464610,7.394542],
    [-8.034252,-23.464610,2.894542],
    [-0.034252,-24.964610,-0.005605],
    [1.465748,-23.464610,8.394542],
    [-4.234203,-23.464610,7.394542],
    [-0.034252,-24.964610,-0.005605],
    [6.565846,-23.464610,5.494395],
    [1.465748,-23.464610,8.394542],
    [-0.034252,-24.964610,-0.005605],
    [8.565846,-23.464610,-0.005605],
    [6.565846,-23.464610,5.494395],
    [8.565846,-23.464610,-0.005605],
    [6.565846,-23.464610,-5.505605],
    [12.365650,-19.164561,-10.305654],
    [8.565846,-23.464610,-0.005605],
    [12.365650,-19.164561,-10.305654],
    [16.065846,-19.164561,-0.005605],
    [6.565846,-23.464610,-5.505605],
    [1.465748,-23.464610,-8.405507],
    [2.765797,-19.164561,-15.805654],
    [6.565846,-23.464610,-5.505605],
    [2.765797,-19.164561,-15.805654],
    [12.365650,-19.164561,-10.305654],
    [1.465748,-23.464610,8.394542],
    [6.565846,-23.464610,5.494395],
    [12.365650,-19.164561,10.294444],
    [1.465748,-23.464610,8.394542],
    [12.365650,-19.164561,10.294444],
    [2.765797,-19.164561,15.794444],
    [6.565846,-23.464610,5.494395],
    [8.565846,-23.464610,-0.005605],
    [16.065846,-19.164561,-0.005605],
    [6.565846,-23.464610,5.494395],
    [16.065846,-19.164561,-0.005605],
    [12.365650,-19.164561,10.294444],
    [16.065846,-19.164561,-0.005605],
    [12.365650,-19.164561,-10.305654],
    [16.565846,-12.464610,-13.905507],
    [16.065846,-19.164561,-0.005605],
    [16.565846,-12.464610,-13.905507],
    [21.665699,-12.464610,-0.005605],
    [12.365650,-19.164561,-10.305654],
    [2.765797,-19.164561,-15.805654],
    [3.765797,-12.464610,-21.305654],
    [12.365650,-19.164561,-10.305654],
    [3.765797,-12.464610,-21.305654],
    [16.565846,-12.464610,-13.905507],
    [2.765797,-19.164561,-15.805654],
    [-8.034252,-19.164561,-13.905507],
    [-10.834301,-12.464610,-18.705556],
    [2.765797,-19.164561,-15.805654],
    [-10.834301,-12.464610,-18.705556],
    [3.765797,-12.464610,-21.305654],
    [-8.034252,-19.164561,-13.905507],
    [-15.134350,-19.164561,-5.505605],
    [-20.334301,-12.464610,-7.405507],
    [-8.034252,-19.164561,-13.905507],
    [-20.334301,-12.464610,-7.405507],
    [-10.834301,-12.464610,-18.705556],
    [-15.134350,-19.164561,5.494395],
    [-8.034252,-19.164561,13.894542],
    [-10.834301,-12.464610,18.794444],
    [-15.134350,-19.164561,5.494395],
    [-10.834301,-12.464610,18.794444],
    [-20.334301,-12.464610,7.394542],
    [-8.034252,-19.164561,13.894542],
    [2.765797,-19.164561,15.794444],
    [3.765797,-12.464610,21.294444],
    [-8.034252,-19.164561,13.894542],
    [3.765797,-12.464610,21.294444],
    [-10.834301,-12.464610,18.794444],
    [2.765797,-19.164561,15.794444],
    [12.365650,-19.164561,10.294444],
    [16.565846,-12.464610,13.894542],
    [2.765797,-19.164561,15.794444],
    [16.565846,-12.464610,13.894542],
    [3.765797,-12.464610,21.294444],
    [12.365650,-19.164561,10.294444],
    [16.065846,-19.164561,-0.005605],
    [21.665699,-12.464610,-0.005605],
    [12.365650,-19.164561,10.294444],
    [21.665699,-12.464610,-0.005605],
    [16.565846,-12.464610,13.894542],
    [3.765797,-12.464610,-21.305654],
    [-10.834301,-12.464610,-18.705556],
    [-12.334301,-4.364512,-21.305654],
    [3.765797,-12.464610,-21.305654],
    [-12.334301,-4.364512,-21.305654],
    [4.265797,-4.364512,-24.205556],
    [-10.834301,-12.464610,-18.705556],
    [-20.334301,-12.464610,-7.405507],
    [-23.134350,-4.364512,-8.405507],
    [-10.834301,-12.464610,-18.705556],
    [-23.134350,-4.364512,-8.405507],
    [-12.334301,-4.364512,-21.305654],
    [-10.834301,-12.464610,18.794444],
    [3.765797,-12.464610,21.294444],
    [4.265797,-4.364512,24.294444],
    [-10.834301,-12.464610,18.794444],
    [4.265797,-4.364512,24.294444],
    [-12.334301,-4.364512,21.294444],
    [3.765797,-12.464610,21.294444],
    [16.565846,-12.464610,13.894542],
    [18.865650,-4.364512,15.794444],
    [3.765797,-12.464610,21.294444],
    [18.865650,-4.364512,15.794444],
    [4.265797,-4.364512,24.294444],
    [-23.134350,4.335439,8.394542],
    [-12.334301,4.335439,21.294444],
    [-10.834301,12.535390,18.794444],
    [-23.134350,4.335439,8.394542],
    [-10.834301,12.535390,18.794444],
    [-20.334301,12.535390,7.394542],
    [-12.334301,4.335439,21.294444],
    [4.265797,4.335439,24.294444],
    [3.765797,12.535390,21.294444],
    [-12.334301,4.335439,21.294444],
    [3.765797,12.535390,21.294444],
    [-10.834301,12.535390,18.794444],
    [4.265797,4.335439,24.294444],
    [18.865650,4.335439,15.794444],
    [16.565846,12.535390,13.894542],
    [4.265797,4.335439,24.294444],
    [16.565846,12.535390,13.894542],
    [3.765797,12.535390,21.294444],
    [21.665699,12.535390,-0.005605],
    [16.565846,12.535390,-13.905507],
    [12.365650,19.135488,-10.305654],
    [21.665699,12.535390,-0.005605],
    [12.365650,19.135488,-10.305654],
    [16.065846,19.135488,-0.005605],
    [-20.334301,12.535390,7.394542],
    [-10.834301,12.535390,18.794444],
    [-8.034252,19.135488,13.894542],
    [-20.334301,12.535390,7.394542],
    [-8.034252,19.135488,13.894542],
    [-15.134350,19.135488,5.494395],
    [-10.834301,12.535390,18.794444],
    [3.765797,12.535390,21.294444],
    [2.765797,19.135488,15.794444],
    [-10.834301,12.535390,18.794444],
    [2.765797,19.135488,15.794444],
    [-8.034252,19.135488,13.894542],
    [3.765797,12.535390,21.294444],
    [16.565846,12.535390,13.894542],
    [12.365650,19.135488,10.294444],
    [3.765797,12.535390,21.294444],
    [12.365650,19.135488,10.294444],
    [2.765797,19.135488,15.794444],
    [16.565846,12.535390,13.894542],
    [21.665699,12.535390,-0.005605],
    [16.065846,19.135488,-0.005605],
    [16.565846,12.535390,13.894542],
    [16.065846,19.135488,-0.005605],
    [12.365650,19.135488,10.294444],
    [16.065846,19.135488,-0.005605],
    [12.365650,19.135488,-10.305654],
    [6.565846,23.435292,-5.505605],
    [16.065846,19.135488,-0.005605],
    [6.565846,23.435292,-5.505605],
    [8.565846,23.435292,-0.005605],
    [12.365650,19.135488,-10.305654],
    [2.765797,19.135488,-15.805654],
    [1.465748,23.435292,-8.405507],
    [12.365650,19.135488,-10.305654],
    [1.465748,23.435292,-8.405507],
    [6.565846,23.435292,-5.505605],
    [2.765797,19.135488,15.794444],
    [12.365650,19.135488,10.294444],
    [6.565846,23.435292,5.494395],
    [2.765797,19.135488,15.794444],
    [6.565846,23.435292,5.494395],
    [1.465748,23.435292,8.394542],
    [12.365650,19.135488,10.294444],
    [16.065846,19.135488,-0.005605],
    [8.565846,23.435292,-0.005605],
    [12.365650,19.135488,10.294444],
    [8.565846,23.435292,-0.005605],
    [6.565846,23.435292,5.494395],
    [8.565846,23.435292,-0.005605],
    [6.565846,23.435292,-5.505605],
    [-0.034252,25.035390,-0.005605],
    [6.565846,23.435292,-5.505605],
    [1.465748,23.435292,-8.405507],
    [-0.034252,25.035390,-0.005605],
    [1.465748,23.435292,-8.405507],
    [-4.234203,23.435292,-7.405507],
    [-0.034252,25.035390,-0.005605],
    [-4.234203,23.435292,-7.405507],
    [-8.034252,23.435292,-2.905507],
    [-0.034252,25.035390,-0.005605],
    [-8.034252,23.435292,-2.905507],
    [-8.034252,23.435292,2.894542],
    [-0.034252,25.035390,-0.005605],
    [-8.034252,23.435292,2.894542],
    [-4.234203,23.435292,7.394542],
    [-0.034252,25.035390,-0.005605],
    [-4.234203,23.435292,7.394542],
    [1.465748,23.435292,8.394542],
    [-0.034252,25.035390,-0.005605],
    [1.465748,23.435292,8.394542],
    [6.565846,23.435292,5.494395],
    [-0.034252,25.035390,-0.005605],
    [6.565846,23.435292,5.494395],
    [8.565846,23.435292,-0.005605],
    [-0.034252,25.035390,-0.005605],
    [1.465748,-23.464610,-8.405507],
    [-4.234203,-23.464610,-7.405507],
    [-8.034252,-19.164561,-13.905507],
    [1.465748,-23.464610,-8.405507],
    [-8.034252,-19.164561,-13.905507],
    [2.765797,-19.164561,-15.805654],
    [-4.234203,-23.464610,-7.405507],
    [-8.034252,-23.464610,-2.905507],
    [-15.134350,-19.164561,-5.505605],
    [-4.234203,-23.464610,-7.405507],
    [-15.134350,-19.164561,-5.505605],
    [-8.034252,-19.164561,-13.905507],
    [-8.034252,-23.464610,2.894542],
    [-4.234203,-23.464610,7.394542],
    [-8.034252,-19.164561,13.894542],
    [-8.034252,-23.464610,2.894542],
    [-8.034252,-19.164561,13.894542],
    [-15.134350,-19.164561,5.494395],
    [-4.234203,-23.464610,7.394542],
    [1.465748,-23.464610,8.394542],
    [2.765797,-19.164561,15.794444],
    [-4.234203,-23.464610,7.394542],
    [2.765797,-19.164561,15.794444],
    [-8.034252,-19.164561,13.894542],
    [21.665699,-12.464610,-0.005605],
    [16.565846,-12.464610,-13.905507],
    [18.865650,-4.364512,-15.805654],
    [21.665699,-12.464610,-0.005605],
    [18.865650,-4.364512,-15.805654],
    [24.665699,-4.364512,-0.005605],
    [16.565846,-12.464610,-13.905507],
    [3.765797,-12.464610,-21.305654],
    [4.265797,-4.364512,-24.205556],
    [16.565846,-12.464610,-13.905507],
    [4.265797,-4.364512,-24.205556],
    [18.865650,-4.364512,-15.805654],
    [-20.334301,-12.464610,7.394542],
    [-10.834301,-12.464610,18.794444],
    [-12.334301,-4.364512,21.294444],
    [-20.334301,-12.464610,7.394542],
    [-12.334301,-4.364512,21.294444],
    [-23.134350,-4.364512,8.394542],
    [16.565846,-12.464610,13.894542],
    [21.665699,-12.464610,-0.005605],
    [24.665699,-4.364512,-0.005605],
    [16.565846,-12.464610,13.894542],
    [24.665699,-4.364512,-0.005605],
    [18.865650,-4.364512,15.794444],
    [24.665699,4.335439,-0.005605],
    [18.865650,4.335439,-15.805654],
    [16.565846,12.535390,-13.905507],
    [24.665699,4.335439,-0.005605],
    [16.565846,12.535390,-13.905507],
    [21.665699,12.535390,-0.005605],
    [18.865650,4.335439,-15.805654],
    [4.265797,4.335439,-24.205556],
    [3.765797,12.535390,-21.305654],
    [18.865650,4.335439,-15.805654],
    [3.765797,12.535390,-21.305654],
    [16.565846,12.535390,-13.905507],
    [4.265797,4.335439,-24.205556],
    [-12.334301,4.335439,-21.305654],
    [-10.834301,12.535390,-18.705556],
    [4.265797,4.335439,-24.205556],
    [-10.834301,12.535390,-18.705556],
    [3.765797,12.535390,-21.305654],
    [-12.334301,4.335439,-21.305654],
    [-23.134350,4.335439,-8.405507],
    [-20.334301,12.535390,-7.405507],
    [-12.334301,4.335439,-21.305654],
    [-20.334301,12.535390,-7.405507],
    [-10.834301,12.535390,-18.705556],
    [18.865650,4.335439,15.794444],
    [24.665699,4.335439,-0.005605],
    [21.665699,12.535390,-0.005605],
    [18.865650,4.335439,15.794444],
    [21.665699,12.535390,-0.005605],
    [16.565846,12.535390,13.894542],
    [16.565846,12.535390,-13.905507],
    [3.765797,12.535390,-21.305654],
    [2.765797,19.135488,-15.805654],
    [16.565846,12.535390,-13.905507],
    [2.765797,19.135488,-15.805654],
    [12.365650,19.135488,-10.305654],
    [3.765797,12.535390,-21.305654],
    [-10.834301,12.535390,-18.705556],
    [-8.034252,19.135488,-13.905507],
    [3.765797,12.535390,-21.305654],
    [-8.034252,19.135488,-13.905507],
    [2.765797,19.135488,-15.805654],
    [-10.834301,12.535390,-18.705556],
    [-20.334301,12.535390,-7.405507],
    [-15.134350,19.135488,-5.505605],
    [-10.834301,12.535390,-18.705556],
    [-15.134350,19.135488,-5.505605],
    [-8.034252,19.135488,-13.905507],
    [2.765797,19.135488,-15.805654],
    [-8.034252,19.135488,-13.905507],
    [-4.234203,23.435292,-7.405507],
    [2.765797,19.135488,-15.805654],
    [-4.234203,23.435292,-7.405507],
    [1.465748,23.435292,-8.405507],
    [-8.034252,19.135488,-13.905507],
    [-15.134350,19.135488,-5.505605],
    [-8.034252,23.435292,-2.905507],
    [-8.034252,19.135488,-13.905507],
    [-8.034252,23.435292,-2.905507],
    [-4.234203,23.435292,-7.405507],
    [-15.134350,19.135488,5.494395],
    [-8.034252,19.135488,13.894542],
    [-4.234203,23.435292,7.394542],
    [-15.134350,19.135488,5.494395],
    [-4.234203,23.435292,7.394542],
    [-8.034252,23.435292,2.894542],
    [-8.034252,19.135488,13.894542],
    [2.765797,19.135488,15.794444],
    [1.465748,23.435292,8.394542],
    [-8.034252,19.135488,13.894542],
    [1.465748,23.435292,8.394542],
    [-4.234203,23.435292,7.394542],
    [-8.034252,-23.464610,-2.905507],
    [-8.034252,-23.464610,2.894542],
    [-15.134350,-19.164561,5.494395],
    [-8.034252,-23.464610,-2.905507],
    [-15.134350,-19.164561,5.494395],
    [-15.134350,-19.164561,-5.505605],
    [-15.134350,-19.164561,-5.505605],
    [-15.134350,-19.164561,5.494395],
    [-20.334301,-12.464610,7.394542],
    [-15.134350,-19.164561,-5.505605],
    [-20.334301,-12.464610,7.394542],
    [-20.334301,-12.464610,-7.405507],
    [-20.334301,-12.464610,-7.405507],
    [-20.334301,-12.464610,7.394542],
    [-23.134350,-4.364512,8.394542],
    [-20.334301,-12.464610,-7.405507],
    [-23.134350,-4.364512,8.394542],
    [-23.134350,-4.364512,-8.405507],
    [24.665699,-4.364512,-0.005605],
    [18.865650,-4.364512,-15.805654],
    [18.865650,4.335439,-15.805654],
    [24.665699,-4.364512,-0.005605],
    [18.865650,4.335439,-15.805654],
    [24.665699,4.335439,-0.005605],
    [18.865650,-4.364512,-15.805654],
    [4.265797,-4.364512,-24.205556],
    [4.265797,4.335439,-24.205556],
    [18.865650,-4.364512,-15.805654],
    [4.265797,4.335439,-24.205556],
    [18.865650,4.335439,-15.805654],
    [4.265797,-4.364512,-24.205556],
    [-12.334301,-4.364512,-21.305654],
    [-12.334301,4.335439,-21.305654],
    [4.265797,-4.364512,-24.205556],
    [-12.334301,4.335439,-21.305654],
    [4.265797,4.335439,-24.205556],
    [-12.334301,-4.364512,-21.305654],
    [-23.134350,-4.364512,-8.405507],
    [-23.134350,4.335439,-8.405507],
    [-12.334301,-4.364512,-21.305654],
    [-23.134350,4.335439,-8.405507],
    [-12.334301,4.335439,-21.305654],
    [-23.134350,-4.364512,-8.405507],
    [-23.134350,-4.364512,8.394542],
    [-23.134350,4.335439,8.394542],
    [-23.134350,-4.364512,-8.405507],
    [-23.134350,4.335439,8.394542],
    [-23.134350,4.335439,-8.405507],
    [-23.134350,-4.364512,8.394542],
    [-12.334301,-4.364512,21.294444],
    [-12.334301,4.335439,21.294444],
    [-23.134350,-4.364512,8.394542],
    [-12.334301,4.335439,21.294444],
    [-23.134350,4.335439,8.394542],
    [-12.334301,-4.364512,21.294444],
    [4.265797,-4.364512,24.294444],
    [4.265797,4.335439,24.294444],
    [-12.334301,-4.364512,21.294444],
    [4.265797,4.335439,24.294444],
    [-12.334301,4.335439,21.294444],
    [4.265797,-4.364512,24.294444],
    [18.865650,-4.364512,15.794444],
    [18.865650,4.335439,15.794444],
    [4.265797,-4.364512,24.294444],
    [18.865650,4.335439,15.794444],
    [4.265797,4.335439,24.294444],
    [18.865650,-4.364512,15.794444],
    [24.665699,-4.364512,-0.005605],
    [24.665699,4.335439,-0.005605],
    [18.865650,-4.364512,15.794444],
    [24.665699,4.335439,-0.005605],
    [18.865650,4.335439,15.794444],
    [-23.134350,4.335439,-8.405507],
    [-23.134350,4.335439,8.394542],
    [-20.334301,12.535390,7.394542],
    [-23.134350,4.335439,-8.405507],
    [-20.334301,12.535390,7.394542],
    [-20.334301,12.535390,-7.405507],
    [-20.334301,12.535390,-7.405507],
    [-20.334301,12.535390,7.394542],
    [-15.134350,19.135488,5.494395],
    [-20.334301,12.535390,-7.405507],
    [-15.134350,19.135488,5.494395],
    [-15.134350,19.135488,-5.505605],
    [-15.134350,19.135488,-5.505605],
    [-15.134350,19.135488,5.494395],
    [-8.034252,23.435292,2.894542],
    [-15.134350,19.135488,-5.505605],
    [-8.034252,23.435292,2.894542],
    [-8.034252,23.435292,-2.905507]
])

def scale_factor(n):
    # scale = Ball's diameter * n(assuming ball's size is 1/n of a galaxy) / milky way's diameter(MPC)
    return 50*n/(105700/3261563.77694)

def generateBallObj(coordinate_matrix,folder_dist):
    
    if not os.path.exists(folder_dist):
        os.makedirs(folder_dist)
    
    np.set_printoptions(suppress=True)

    big_batch=2500
    big_batch_num=int(len(coordinate_matrix)/big_batch)+1
    for i in tqdm(range(0, big_batch_num)):
        coordinate_matrix_mini = coordinate_matrix[i*big_batch:(i+1)*big_batch]
        file_name="%d.obj"%i

        vertices=""
        mini_batch=10
        mini_batch_num=int(len(coordinate_matrix_mini)/mini_batch)+1
        for j in tqdm(range(0, mini_batch_num)):
            #不知道为什么obj文件中的y轴在各个3D软件中都正负相反，然而虚幻4中的y轴正方向是向左的（超星系坐标系中x轴向内、y轴向右），所以就刚好不用取反了。
            # pos[0,1]*=-1 

            thing=coordinate_matrix_mini[j*mini_batch:(j+1)*mini_batch]
            a=np.repeat(thing, len(ball), axis=0)
            b=np.tile(ball, (len(thing),1))
            c=a+b
            if c.shape[0]>0:
                temp=np.array2string(c,precision=6,separator=" ",threshold = 10e20)[:-1]
                temp="\n".join([ "v "+j[2:-1] for j in temp.split("\n")])
                vertices+=temp+"\n"

        faces=np.arange(1,len(ball)*len(coordinate_matrix_mini)+1).reshape(-1,3)
        faces=np.array2string(faces,precision=6,separator=" ",threshold = 10e20)[:-1]
        faces="\n".join([ "f "+j[2:-1] for j in faces.split("\n")])
        
        obj_str=vertices+"\n"+faces
        
        with open(os.path.join(folder_dist,file_name),"w") as f:
            f.write(obj_str)